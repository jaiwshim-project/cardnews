# AI CardNews Generator 개발 계획서

## 1. 프로젝트 개요

### 1.1 프로젝트명
**AI CardNews Generator** (AI 카드뉴스 생성기)

### 1.2 프로젝트 목적
사용자가 최소한의 정보만 입력하면 AI가 카드뉴스의 **사고 흐름 → 카드별 문장 → 디자인 → 출력물**까지 자동으로 생성하는 시스템 개발

### 1.3 핵심 차별점
| 기존 툴 | 본 시스템 |
|---------|-----------|
| 디자인 중심 | 사고·메시지 중심 |
| 템플릿 선택 | 흐름 자동 설계 |
| 문장 자유 | 문장 규칙 강제 |
| 감각 의존 | 심리 구조 기반 |

---

## 2. 기술 스택

### 2.1 Frontend
```
Framework: Next.js 14 (App Router)
Language: TypeScript
UI Library: Tailwind CSS + shadcn/ui
State Management: Zustand
Image Rendering: html2canvas / Konva.js
```

### 2.2 Backend
```
Framework: FastAPI (Python 3.11+)
AI Engine: OpenAI GPT-4 / Claude API
Database: PostgreSQL 15
Cache: Redis
File Storage: AWS S3 / Cloudflare R2
Task Queue: Celery (비동기 이미지 생성)
```

### 2.3 Infrastructure
```
Container: Docker + Docker Compose
Orchestration: Kubernetes (프로덕션)
CI/CD: GitHub Actions
Monitoring: Prometheus + Grafana
Logging: ELK Stack
```

### 2.4 개발 도구
```
API Documentation: Swagger / OpenAPI 3.0
Code Quality: ESLint, Prettier, Black, Ruff
Testing: Jest, Pytest, Playwright
Version Control: Git + GitHub
```

---

## 3. 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│                        CLIENT LAYER                          │
├─────────────────────────────────────────────────────────────┤
│  [User Web App]          [Admin Dashboard]                   │
│   - Next.js 14            - Next.js 14                       │
│   - 카드뉴스 생성          - 품질 모니터링                    │
│   - 미리보기/다운로드       - A/B 테스트 관리                  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        API GATEWAY                           │
│                    (Nginx / Kong)                            │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      SERVICE LAYER                           │
├─────────────────────────────────────────────────────────────┤
│  [CardNews API]     [AI Engine]      [Render Service]       │
│   - FastAPI          - GPT-4/Claude   - Image Generation    │
│   - 요청 처리         - 문장 생성       - PDF Export          │
│   - 품질 검증         - 흐름 설계       - Format Conversion   │
├─────────────────────────────────────────────────────────────┤
│  [Domain Rule Engine]    [Quality Scorer]    [A/B Manager]  │
│   - 금지어 필터링         - 품질 점수화       - 변형 생성      │
│   - 도메인별 규칙         - 4영역 평가        - 성과 추적      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                       DATA LAYER                             │
├─────────────────────────────────────────────────────────────┤
│  [PostgreSQL]        [Redis]           [S3/R2]              │
│   - 사용자 데이터     - 세션 캐시        - 이미지 저장        │
│   - 생성 로그        - 생성 결과 캐시    - PDF 저장          │
│   - A/B 결과         - Rate Limiting    - 템플릿 에셋       │
└─────────────────────────────────────────────────────────────┘
```

---

## 4. 개발 단계 및 마일스톤

### Phase 1: Foundation (기반 구축)
**목표**: 개발 환경 구축 및 핵심 인프라 설정

| 작업 | 상세 내용 |
|------|-----------|
| 개발 환경 설정 | Docker 환경, DB 설정, Git 레포지토리 |
| 프로젝트 초기화 | Next.js, FastAPI 프로젝트 생성 |
| DB 스키마 설계 | ERD 작성, 마이그레이션 스크립트 |
| API 기본 구조 | 인증, 에러 핸들링, 로깅 |
| CI/CD 파이프라인 | GitHub Actions 설정 |

### Phase 2: Core Engine (핵심 엔진)
**목표**: AI 기반 카드뉴스 생성 엔진 개발

| 작업 | 상세 내용 |
|------|-----------|
| Purpose Analyzer | 목적 분석 및 카드 수 결정 |
| Card Flow Generator | 카드 역할 자동 설계 (HOOK→CTA) |
| Card Copy Generator | 카드별 문장 생성 |
| Domain Rule Engine | 도메인별 규칙 적용 |
| Quality Scorer | 품질 점수 산정 로직 |

### Phase 3: User Interface (사용자 인터페이스)
**목표**: 사용자용 웹 애플리케이션 개발

| 작업 | 상세 내용 |
|------|-----------|
| 입력 폼 UI | 5가지 필수 입력 인터페이스 |
| 생성 프로세스 UI | 로딩, 진행 상태 표시 |
| 미리보기 UI | 카드별 미리보기, 수정 |
| 다운로드 기능 | PNG, PDF, ZIP 출력 |
| 반응형 디자인 | 모바일/태블릿/PC 대응 |

### Phase 4: Design System (디자인 시스템)
**목표**: 템플릿 및 렌더링 시스템 구축

| 작업 | 상세 내용 |
|------|-----------|
| 템플릿 구조 설계 | JSON 기반 템플릿 스키마 |
| 도메인별 템플릿 | 병원/선거/교육 템플릿 세트 |
| Design Mapper | 자동 템플릿 매칭 로직 |
| Image Renderer | 카드 이미지 생성 엔진 |
| Export Module | 다양한 비율/포맷 지원 |

### Phase 5: Admin Dashboard (관리자 대시보드)
**목표**: 운영자용 관리 시스템 개발

| 작업 | 상세 내용 |
|------|-----------|
| 대시보드 홈 | 핵심 지표 시각화 |
| 생성 로그 관리 | 이력 조회, 필터링 |
| 품질 모니터링 | 점수 분포, 알림 |
| 도메인 규칙 관리 | 금지어/권장어 CRUD |
| 사용자 관리 | 계정 관리, 통계 |

### Phase 6: A/B Testing (A/B 테스트)
**목표**: 콘텐츠 최적화 실험 시스템

| 작업 | 상세 내용 |
|------|-----------|
| A/B 테스트 엔진 | 변형 생성, 분배 로직 |
| 성과 추적 시스템 | 지표 수집, 분석 |
| 관리 UI | 테스트 생성/관리/결과 |
| AI 피드백 반영 | 학습 데이터 적용 |

### Phase 7: Launch Prep (런칭 준비)
**목표**: 프로덕션 배포 및 안정화

| 작업 | 상세 내용 |
|------|-----------|
| 성능 최적화 | 응답 시간 10초 이내 |
| 보안 점검 | 취약점 스캔, 수정 |
| 부하 테스트 | 동시 사용자 테스트 |
| 문서화 | API 문서, 사용자 가이드 |
| 배포 | 프로덕션 환경 배포 |

---

## 5. 데이터베이스 설계

### 5.1 ERD 개요

```
┌──────────────────┐      ┌──────────────────┐
│      users       │      │    cardnews      │
├──────────────────┤      ├──────────────────┤
│ id (PK)          │──┐   │ id (PK)          │
│ email            │  │   │ user_id (FK)     │──┐
│ name             │  └──▶│ request_id       │  │
│ role             │      │ purpose          │  │
│ created_at       │      │ domain           │  │
│ updated_at       │      │ target           │  │
└──────────────────┘      │ core_message     │  │
                          │ tone             │  │
                          │ cta              │  │
                          │ quality_score    │  │
                          │ status           │  │
                          │ created_at       │  │
                          └──────────────────┘  │
                                    │           │
                                    ▼           │
                          ┌──────────────────┐  │
                          │      cards       │  │
                          ├──────────────────┤  │
                          │ id (PK)          │  │
                          │ cardnews_id (FK) │──┘
                          │ index            │
                          │ role             │
                          │ text             │
                          │ template_id (FK) │──┐
                          │ created_at       │  │
                          └──────────────────┘  │
                                                │
┌──────────────────┐      ┌──────────────────┐  │
│  domain_rules    │      │    templates     │◀─┘
├──────────────────┤      ├──────────────────┤
│ id (PK)          │      │ id (PK)          │
│ domain           │      │ name             │
│ rule_type        │      │ domain           │
│ rule_value       │      │ tone             │
│ is_active        │      │ card_role        │
│ created_at       │      │ config_json      │
└──────────────────┘      │ is_active        │
                          │ created_at       │
                          └──────────────────┘

┌──────────────────┐      ┌──────────────────┐
│    ab_tests      │      │   ab_variants    │
├──────────────────┤      ├──────────────────┤
│ id (PK)          │──┐   │ id (PK)          │
│ base_cardnews_id │  │   │ ab_test_id (FK)  │──┐
│ test_element     │  └──▶│ variant_code     │  │
│ status           │      │ changed_element  │  │
│ winner_variant   │      │ text             │  │
│ created_at       │      │ impressions      │  │
│ ended_at         │      │ conversions      │  │
└──────────────────┘      │ created_at       │  │
                          └──────────────────┘  │
                                                │
                          ┌──────────────────┐  │
                          │  ab_results      │◀─┘
                          ├──────────────────┤
                          │ id (PK)          │
                          │ variant_id (FK)  │
                          │ metric_type      │
                          │ metric_value     │
                          │ recorded_at      │
                          └──────────────────┘
```

### 5.2 주요 테이블 정의

#### users
```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    name VARCHAR(100),
    role VARCHAR(20) DEFAULT 'user',  -- user, operator, content_admin, super_admin
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### cardnews
```sql
CREATE TABLE cardnews (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    request_id VARCHAR(50) UNIQUE NOT NULL,
    purpose VARCHAR(20) NOT NULL,      -- info, promotion, reservation, persuasion
    domain VARCHAR(20) NOT NULL,       -- hospital, election, education, general
    target TEXT NOT NULL,
    core_message TEXT NOT NULL,
    tone VARCHAR(20) NOT NULL,         -- professional, empathetic, warm, assertive
    cta TEXT NOT NULL,
    quality_score INTEGER,
    flow_score INTEGER,
    copy_score INTEGER,
    domain_score INTEGER,
    cta_score INTEGER,
    status VARCHAR(20) DEFAULT 'pending',  -- pending, processing, completed, failed
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### cards
```sql
CREATE TABLE cards (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    cardnews_id UUID REFERENCES cardnews(id) ON DELETE CASCADE,
    index INTEGER NOT NULL,
    role VARCHAR(20) NOT NULL,         -- HOOK, EMPATHY, PROBLEM, SOLUTION, CTA
    text TEXT NOT NULL,
    template_id UUID REFERENCES templates(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(cardnews_id, index)
);
```

---

## 6. API 엔드포인트 목록

### 6.1 카드뉴스 API
| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/api/v1/cardnews/generate` | 카드뉴스 생성 |
| GET | `/api/v1/cardnews/{id}` | 카드뉴스 조회 |
| GET | `/api/v1/cardnews/{id}/export` | 카드뉴스 내보내기 |
| PUT | `/api/v1/cardnews/{id}/cards/{index}` | 개별 카드 수정 |
| POST | `/api/v1/cardnews/{id}/regenerate` | 카드뉴스 재생성 |
| DELETE | `/api/v1/cardnews/{id}` | 카드뉴스 삭제 |

### 6.2 템플릿 API
| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/v1/templates` | 템플릿 목록 |
| GET | `/api/v1/templates/{id}` | 템플릿 상세 |
| POST | `/api/v1/templates` | 템플릿 등록 (Admin) |
| PUT | `/api/v1/templates/{id}` | 템플릿 수정 (Admin) |

### 6.3 도메인 규칙 API
| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/v1/rules/{domain}` | 도메인 규칙 조회 |
| PUT | `/api/v1/rules/{domain}` | 도메인 규칙 수정 (Admin) |

### 6.4 A/B 테스트 API
| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/api/v1/ab-tests` | A/B 테스트 생성 |
| GET | `/api/v1/ab-tests/{id}` | A/B 테스트 조회 |
| GET | `/api/v1/ab-tests/{id}/results` | 테스트 결과 조회 |
| PUT | `/api/v1/ab-tests/{id}/end` | 테스트 종료 |

### 6.5 관리자 API
| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/v1/admin/dashboard` | 대시보드 통계 |
| GET | `/api/v1/admin/cardnews` | 전체 카드뉴스 로그 |
| GET | `/api/v1/admin/quality-stats` | 품질 통계 |
| GET | `/api/v1/admin/users` | 사용자 관리 |

---

## 7. 프로젝트 디렉토리 구조

```
ai-cardnews-generator/
├── frontend/                    # Next.js 프론트엔드
│   ├── app/
│   │   ├── (user)/             # 사용자 페이지
│   │   │   ├── page.tsx        # 홈
│   │   │   ├── create/         # 카드뉴스 생성
│   │   │   ├── preview/        # 미리보기
│   │   │   └── history/        # 생성 이력
│   │   ├── (admin)/            # 관리자 페이지
│   │   │   ├── dashboard/      # 대시보드
│   │   │   ├── cardnews/       # 카드뉴스 관리
│   │   │   ├── quality/        # 품질 모니터링
│   │   │   ├── ab-tests/       # A/B 테스트
│   │   │   ├── rules/          # 도메인 규칙
│   │   │   ├── templates/      # 템플릿 관리
│   │   │   └── users/          # 사용자 관리
│   │   └── api/                # API Routes
│   ├── components/
│   │   ├── ui/                 # 기본 UI 컴포넌트
│   │   ├── cardnews/           # 카드뉴스 관련
│   │   ├── admin/              # 관리자 관련
│   │   └── shared/             # 공통 컴포넌트
│   ├── lib/                    # 유틸리티
│   ├── hooks/                  # Custom Hooks
│   ├── store/                  # Zustand Store
│   └── types/                  # TypeScript 타입
│
├── backend/                    # FastAPI 백엔드
│   ├── app/
│   │   ├── api/
│   │   │   ├── v1/
│   │   │   │   ├── cardnews.py
│   │   │   │   ├── templates.py
│   │   │   │   ├── rules.py
│   │   │   │   ├── ab_tests.py
│   │   │   │   └── admin.py
│   │   │   └── deps.py         # 의존성
│   │   ├── core/
│   │   │   ├── config.py       # 설정
│   │   │   ├── security.py     # 인증
│   │   │   └── logging.py      # 로깅
│   │   ├── models/             # SQLAlchemy 모델
│   │   ├── schemas/            # Pydantic 스키마
│   │   ├── services/
│   │   │   ├── ai_engine/      # AI 엔진
│   │   │   │   ├── purpose_analyzer.py
│   │   │   │   ├── flow_generator.py
│   │   │   │   ├── copy_generator.py
│   │   │   │   └── prompts.py
│   │   │   ├── domain_rules/   # 도메인 규칙
│   │   │   ├── quality_scorer/ # 품질 점수
│   │   │   ├── design_mapper/  # 디자인 매핑
│   │   │   └── renderer/       # 이미지 렌더링
│   │   └── db/
│   │       ├── base.py
│   │       └── session.py
│   ├── tests/                  # 테스트
│   ├── alembic/                # DB 마이그레이션
│   └── requirements.txt
│
├── shared/                     # 공유 리소스
│   ├── templates/              # 디자인 템플릿
│   │   ├── hospital/
│   │   ├── election/
│   │   └── education/
│   └── rules/                  # 도메인 규칙 JSON
│       ├── hospital.json
│       ├── election.json
│       └── education.json
│
├── docker/
│   ├── Dockerfile.frontend
│   ├── Dockerfile.backend
│   └── docker-compose.yml
│
├── docs/                       # 문서
│   ├── 01_개발계획서.md
│   ├── 02_메뉴구성.md
│   ├── 03_API명세서.md
│   └── 04_디자인가이드.md
│
├── .github/
│   └── workflows/
│       └── ci.yml
│
├── .env.example
├── README.md
└── Makefile
```

---

## 8. 개발 환경 설정

### 8.1 필수 소프트웨어
- Node.js 20+
- Python 3.11+
- Docker & Docker Compose
- PostgreSQL 15
- Redis 7

### 8.2 로컬 개발 시작
```bash
# 레포지토리 클론
git clone https://github.com/your-org/ai-cardnews-generator.git
cd ai-cardnews-generator

# 환경 변수 설정
cp .env.example .env

# Docker로 DB/Redis 실행
docker-compose up -d postgres redis

# 백엔드 실행
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
uvicorn app.main:app --reload

# 프론트엔드 실행 (새 터미널)
cd frontend
npm install
npm run dev
```

---

## 9. 품질 관리 기준

### 9.1 코드 품질
- **테스트 커버리지**: 80% 이상
- **린트 통과**: ESLint, Ruff 에러 0
- **타입 체크**: TypeScript strict mode

### 9.2 성능 기준
| 항목 | 목표 |
|------|------|
| 카드뉴스 생성 시간 | 10초 이내 |
| API 응답 시간 (일반) | 200ms 이내 |
| 페이지 로드 시간 | 3초 이내 |
| 동시 사용자 | 100명 |

### 9.3 보안 기준
- OWASP Top 10 취약점 점검
- API 인증/인가 적용
- 민감 데이터 암호화
- Rate Limiting 적용

---

## 10. 릴리즈 계획

### MVP (v1.0)
- 5장 카드뉴스 생성
- 병원/선거/교육 도메인
- PNG/PDF 다운로드
- 기본 품질 검증

### v1.1
- 관리자 대시보드
- A/B 테스트 기능
- 품질 모니터링

### v1.2
- 카드 수 커스터마이징
- 사용자 디자인 편집
- 성과 분석 연동

### v2.0
- AI 학습 피드백 반영
- 자동 최적화 시스템
- API 외부 제공

---

## 11. 위험 관리

| 위험 요소 | 대응 방안 |
|-----------|-----------|
| AI 응답 품질 불안정 | 품질 점수 기반 자동 재생성 |
| 도메인 규칙 위반 | Rule Engine 사전 필터링 |
| 이미지 생성 실패 | 재시도 로직 + 폴백 템플릿 |
| 트래픽 급증 | 오토스케일링 + 큐 시스템 |
| API 비용 증가 | 캐싱 + Rate Limiting |

---

**문서 버전**: 1.0
**작성일**: 2026-01-21
**작성자**: AI CardNews Generator 개발팀
